---
title: "Lily Lake Biogeochem"
author: "Matthew J Berens"
date: "1/18/2021"
output: html_notebook
---

```{r setup, include=FALSE}
#Load in the required packages
library(dplyr)
library(ggplot2)
library(tidyverse)
library(rbacon)
library(Bchron)
library(readr)
library(rioja)
library(rlist)
library(ggpmisc)

#Load the Lily Lake Core
setwd("~/Documents/Postdocs/LLO/ISRO_Paleo")
LS16BELL00 <- read_csv("Cores/LS16BELL00/LS16BELL00.csv")
LS16BELLRC <- read_csv("Cores/LS16BELLRC/LS16BELLRC.csv")
LilyLake <- list.load("LilyLake.Rdata")

```

## Oveview

This is an R Markdown document for the analysis of Lily Lake Biogeochem.

## Age-Depth Modeling
Age-Depth modeling performed using Bchron and rbacon packages.

```{r radiocarbon, echo=FALSE}

ageCal <- with(LL16BELLRC,
               Bchronology(ages = age,
                           ageSds = error,
                           calCurves = rep('intcal20', nrow(LS16BELLRC)),
                           positions = depth,
                           ids = labID,
                           predictPositions = LS16BELL00$SedDepth))
```

## Metals Analysis

### Lead and Potassium

```{r metals, echo=FALSE}
metals <- filter(LS16BELL00, IsMetals == "TRUE") %>%
  select(Entry:U) %>%
  pivot_longer(cols = Li:U,
               names_to = "Element",
               values_to = "Value")

metals <- filter(metals, Element == "Pb" | Element == "K")

plot <- metals %>%
  ggplot(aes(AgeMed, Value)) +
  geom_line() +
  theme_bw() +
  #scale_y_reverse() +
  #scale_x_continuous(position = "top") +
  labs(y = "Concentration", x = "Calendar Years BP") +
  facet_grid(Element~., scales = "free_y") +
  stat_peaks(strict = TRUE, geom = "text", ignore_threshold = 0.1)
  
plot
```

There are corresponding peaks in the Pb and K results at 5993 and 9312 yrs BP

```{r organic. echo=FALSE}

organic <- filter(LS16BELL00, IsOrganic == "TRUE") %>%
  select(Entry:d13C) %>%
  select(-(Li:U)) %>%
  pivot_longer(cols = S_V:d13C,
               names_to = "Element",
               values_to = "Value")

organic <- filter(organic, Element == "CN_mol" | Element == "CN_pct")
organic <- organic[!is.na(organic$Value),]

plot <- organic %>%
  #drop_na(Value) %>%
  ggplot(aes(y = SedDepth, x = Value)) +
  #geom_path() +
  geom_point() +
  theme_bw() +
  scale_y_reverse() +
  #scale_x_continuous(position = "top") +
  labs(y = "Depth (cm)", x = "Concentration") +
  facet_grid(Element~., scales = "free_x") 
  #stat_peaks(strict = TRUE, geom = "text", ignore_threshold = 0.1)
  
plot

```